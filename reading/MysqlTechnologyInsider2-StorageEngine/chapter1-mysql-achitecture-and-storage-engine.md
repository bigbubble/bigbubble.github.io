#第一章 MySQL 体系结构和存储引擎
##1.1 定义数据库和实例
数据库：物理操作系统文件和其他形式文件类型的集合。

实例：MySQL数据库由后台线程以及一个共享内存区组成，共享内存可以被运行的后台线程所共享。数据库实例才是真正用于操作数据库文件的。
MySQL 被设计为一个单进程多线程架构的数据库。

当启动数据库实例时，MySQL数据库会去读取配置文件，根据配置文件的参数来启动数据库实例。

读取配置文件顺序：

/etc/my.cnf -> /etc/mysql/my.cnf/ -> ~/.my.conf 

配置文件中有个参数datadir,该参数指定了数据库所在路径，默认为/usr/local/mysql/data,不过该路径只是个链接（system ls -lh /usr/local/mysql/data），指向了/opt/mysql_data目录.
******************************
##1.2 MySQL 体系结构
![mysql achitecteur](/img/mysql-achitecture.jpg "Title")
MySQL由以下几部分组成：

* 连接池组件
* 管理服务和工具组件
* SQL接口组件
* 查询分析器组件
* 优化器组件
* 缓冲(Cache)组件
* 插件式存储引擎
* 物理文件

MySQL数据库区别于其他数据库的一个最重要特点就是 插件式 的表存储引擎。MySQL插件式存储引擎架构提供了一系列标准的管理和服务支持，这些标准和存储引擎本身无关，可能是每个数据库系统本身所必需的，如SQL分析器和优化器等，存储引擎式底层物理结构的实现，每个存储引擎开发者可以按照自己的意愿来进行可发。

需特别注意的是，存储引擎是基于表的，而不是数据库。
******************************
##1.3 MySQL存储引擎
###1.3.1 InnoDB存储引擎
支持事务，设计目标主要面向在线事务处理（OLTP）的应用，特点是支持行锁设计，支持外键，支持类似oracle的非锁定读（默认读取操作不锁定表。）

InnoDB存储引擎将数据放在一个逻辑表空间中，由它自身进行管理，从MySQL4.1开始，他可以将每个InnoDB存储引擎的表单独放到一个独立的ibd文件中。还支持用裸设备（raw disk）用来建立其表空间。

*ibd:MySQL数据文件，索引文件*

*裸设备(raw device)：也叫裸分区（原始分区），是一种没有经过格式化，不被Unix通过文件系统来读取的特殊块设备文件。由应用程序负责对它进行读写操作。不经过文件系统的缓冲。它是不被操作系统直接管理的设备。这种设备少了操作系统这一层，I/O效率更高。不少数据库都能通过使用裸设备作为存储介质来提高I/O效率。*

###1.3.2 MyISAN 存储引擎
不支持事务、表锁设计，支持全文检索，主要面向一些在线分析处理（OLAP）数据库应用，其缓冲池只缓存索引文件，不缓存数据文件，数据文件的缓存交由操作系统来完成。

###1.3.3 NDB 存储引擎
NDB存储引擎式一个集群存储引擎，结构为share nothing的集群结构，其数据全部存放于内存中（5.1开始，可以将非索引数据放在磁盘上），因此主键查找速度极快，并可通过添加数据节点线性的提高数据库性能。

NDB存储引擎的连接操作实在MySQL数据库层完成的，而不是在存储引擎层完成的。这意味着，复杂的连接操作需要巨大的网络开销，因此查询速度较慢。

*数据库构架设计中主要有Shared Everthting、Shared Nothing、和Shared Disk：*

*Shared Everthting:一般是针对单个主机，完全透明共享CPU/MEMORY/IO，并行处理能力是最差的，典型的代表SQLServer*

*Shared Disk：各个处理单元使用自己的私有 CPU和Memory，共享磁盘系统。典型的代表Oracle Rac， 它是数据共享，可通过增加节点来提高并行处理的能力，扩展能力较好。其类似于SMP（对称多处理）模式，但是当存储器接口达到饱和的时候，增加节点并不能获得更高的性能 。*

*Shared Nothing：各个处理单元都有自己私有的CPU/内存/硬盘等，不存在共享资源，类似于MPP（大规模并行处理）模式，各处理单元之间通过协议通信，并行处理和扩展能力更好。典型代表DB2 DPF和hadoop ，各节点相互独立，各自处理自己的数据，处理后的结果可能向上层汇总或在节点间流转。*

*我们常说的 Sharding 其实就是Share Nothing架构，它是把某个表从物理存储上被水平分割，并分配给多台服务器（或多个实例），每台服务器可以独立工作，具备共同的schema，比如MySQL Proxy和Google的各种架构，只需增加服务器数就可以增加处理能力和容量。*

###1.3.4 Memory 存储引擎
Memory存储引擎将数据存放在内存中，非常适合于存储临时数据的临时表，以及数据仓库中的维度表。默认使用哈希索引，而非B+树索引。

Memory存储引擎速度非常快，但只支持表锁，并发能里差，不支持TEXT和BLOB列类型。最重要的是，存储变长字符串（varchar）时是按照定长字符串的方式进行的，因此会浪费内存。

MySQL数据库常用Memory存储引擎作为临时表来存放中间结果集。如果中间结果集大于Memory存储引擎表的容量设置，又或中间表结果包含TEXT和BLOB类型数据，MySQL数据库会将其转换到MyISAM引擎表而存放到磁盘中，但MyISAM不会缓存数据文件，因此这时产生的临时表的性能对于查询会有损失。

###1.3.5 Archive 存储引擎
Archive存储引擎只支持INSERT和SELECT操作，使用zlib算法将数据行压缩，压缩比可达1:10，适合存储归档数据。Archive存储引擎使用行锁实现高并发的插入操作，但本身不是事务安全的存储引擎。

###1.3.6 Federated 存储引擎
Federated存储引擎不存放数据，他只是指向一台远程MySQL数据库服务上的表，只支持MySQL数据的表。

###1.3.7 other ..skiped

******************************
#1.4 各存储引擎之间的比较
 ![engine compare](/img/engine-compare.jpg "Title")

可以使用 SHOW ENGINES或information_schema架构下的ENGINES表查看当前数据库支持的存储引擎
******************************
#1.5 连接MySQL
1. tcp/ip:mysql -h127.0.0.1 -uroot -p
    在通过tcp/ip连接时，MySQL数据库会先检查一张权限视图，判断发起请求的客户端IP是否允许连接到MySQL实例，该视图在MySQL架构下的User表。

2. 明明管道和共享内存

 命名管道：需要配置文件中启用 --enable-named-pipe

 共享内存：添加 --shared-memory,并在客户端连接时使用 --protocol=memory

3. UNIX套接字

 在配置文件中指定套接字文件路径:--socket=/temp/mysql.sock,实例启动后，通过 SHOW VARIABLES LIKE 'socket' 查找

 然后客户端使用套接字方式连接：mysql -uroot -S /temp/mysql.sock

