<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<base href="../../">
	<meta charset="utf8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="shortcut icon" href="img/pb16x16.ico" title="B_Pt">
	<link rel="stylesheet" type="text/css" href="js/bootstrap-3.3.7-dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="js/bootstrap-3.3.7-dist/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="js/syntaxhighlighter/theme.css">
	<link rel="stylesheet" type="text/css" href="css/common.css">
	<title>二叉树显示-echarts</title>
</head>
<body>
	<!-- navitor -->
	<div class="">
		<nav class="navbar navbar-default navbar-static-top">
			<div class="container-fluid">
				<button type="button" class="btn btn-default navbar-btn navbar-right">Home</button>
			</div>
		</nav>
	</div>
	<div class="container-fluid">
		<div id="catalog" class="col-lg-2"></div>
		<div class="col-lg-8">
			<div class="container-fluid">
				<ol class="breadcrumb">
					<li><a href="mainpage.html">Home</a></li>
					<li><a href="#">Algorithm</a></li>
					<li class="active">Article</li>
				</ol>
			</div>
			<div class="container">
				<div class="page-header">
					<h3>二叉树显示-echarts</h3>
					<small>2017-10-17</small>
				</div>
				<div class="bg-gray">
					<p><em>带关系的二叉树显示-echarts</em></p>
				</div>
				<div class="centent">
					<div>
						<p>节点 node 属性:name-名称,leftChild-左节点,rightChild-右节点,relPos-方向(1:左节点是起始,2:右节点是起始),x-节点从左到右的序号,y-节点深度;(x,y)对应以左上角为原点平面坐标系上的一个点</p>
						<p>原始数据x,y没有值,通过中序遍历求出,参数：root:根结点, depth:已计算的深度, length:已计算的长度, list:节点信息数组,xy最大深度和长度,links:连线数组</p>
						<section class="code-section">
							<pre class="brush:javascript">
								function traval(root, depth, length, list,xy,links){
									depth = depth + 1;
									root['y'] = depth;
									if(xy[1] < depth){
										xy[1] = depth;
									}
									root["name"] = root.subjectName;
									if(root.leftChild != null){
										length = traval(root.leftChild, depth, length, list,xy, links);
										var link = {
											"source":root.subjectName,
											"target":root.leftChild.subjectName,
											"symbol":["circle","arrow"]
										}
										if(root.leftChild.relPos == 1){
											link["target"] = root.subjectName;
											link["source"] = root.leftChild.subjectName;
										}
										links.push(link);
									}
									length = length + 1;
									root['x'] = length;
									if(xy[0] < length){
										xy[0] = length;
									}
									if(root.rightChild != null){
										length = traval(root.rightChild, depth, length, list,xy, links);
										var link = {
											"source":root.subjectName,
											"target":root.rightChild.subjectName,
											"symbol":["circle","arrow"]
										}
										if(root.rightChild.relPos == 1){
											link["target"] = root.subjectName;
											link["source"] = root.rightChild.subjectName;
										}
										links.push(link);
									}
									root.left = null;
									root.right = null;
									list.push(root);
									return length;
								}
							</pre>
						</section>
						<p>测试数据：{"leftChild":{"level":2,"order":1,"relPos":2,"relationId":51,"relationName":"内关联","root":false,"subjectId":14,"subjectLib":23,"subjectName":"导致","treePos":1},"level":1,"order":1,"relPos":0,"relationId":0,"rightChild":{"leftChild":{"leftChild":{"level":4,"order":5,"relPos":2,"relationId":11,"relationName":"适用","root":false,"subjectId":18640,"subjectLib":4,"subjectName":"造影","treePos":1},"level":3,"order":3,"relPos":1,"relationId":14,"relationName":"被导致","rightChild":{"level":4,"order":6,"relPos":2,"relationId":3,"relationName":"从属","root":false,"subjectId":12409,"subjectLib":22,"subjectName":"剂","treePos":2},"root":false,"subjectId":45985,"subjectLib":22,"subjectName":"造影剂","treePos":1},"level":2,"order":2,"relPos":2,"relationId":14,"relationName":"导致","rightChild":{"leftChild":{"level":4,"order":7,"relPos":2,"relationId":16,"relationName":"累及","root":false,"subjectId":1553,"subjectLib":3,"subjectName":"肾","treePos":1},"level":3,"order":4,"relPos":2,"relationId":3,"relationName":"从属","rightChild":{"level":4,"order":8,"relPos":2,"relationId":4,"relationName":"属于","root":false,"subjectId":1126,"subjectLib":22,"subjectName":"疾病","treePos":2},"root":false,"subjectId":8414,"subjectLib":1,"subjectName":"肾脏疾患","treePos":2},"root":false,"subjectId":412292,"subjectLib":1,"subjectName":"造影剂肾病","treePos":2},"root":true,"subjectId":520019,"subjectLib":7,"subjectName":"所致造影剂肾病","treePos":0}</p>
					</div>
					<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
    					<div id="binary-tree" style="width: 800px;height:600px;"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="footer text-center"><em>The world is so interesting</em></div>
	</div>
	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="js/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/syntaxhighlighter/syntaxhighlighter.js"></script>
	<script type="text/javascript" src="js/echarts.min.js"></script>
	<script type="text/javascript">
		var str = '{"leftChild":{"level":2,"order":1,"relPos":2,"relationId":51,"relationName":"内关联","root":false,"subjectId":14,"subjectLib":23,"subjectName":"导致","treePos":1},"level":1,"order":1,"relPos":0,"relationId":0,"rightChild":{"leftChild":{"leftChild":{"level":4,"order":5,"relPos":2,"relationId":11,"relationName":"适用","root":false,"subjectId":18640,"subjectLib":4,"subjectName":"造影","treePos":1},"level":3,"order":3,"relPos":1,"relationId":14,"relationName":"被导致","rightChild":{"level":4,"order":6,"relPos":2,"relationId":3,"relationName":"从属","root":false,"subjectId":12409,"subjectLib":22,"subjectName":"剂","treePos":2},"root":false,"subjectId":45985,"subjectLib":22,"subjectName":"造影剂","treePos":1},"level":2,"order":2,"relPos":2,"relationId":14,"relationName":"导致","rightChild":{"leftChild":{"level":4,"order":7,"relPos":2,"relationId":16,"relationName":"累及","root":false,"subjectId":1553,"subjectLib":3,"subjectName":"肾","treePos":1},"level":3,"order":4,"relPos":2,"relationId":3,"relationName":"从属","rightChild":{"level":4,"order":8,"relPos":2,"relationId":4,"relationName":"属于","root":false,"subjectId":1126,"subjectLib":22,"subjectName":"疾病","treePos":2},"root":false,"subjectId":8414,"subjectLib":1,"subjectName":"肾脏疾患","treePos":2},"root":false,"subjectId":412292,"subjectLib":1,"subjectName":"造影剂肾病","treePos":2},"root":true,"subjectId":520019,"subjectLib":7,"subjectName":"所致造影剂肾病","treePos":0}';
		var root = JSON.parse(str);

		function traval(root, depth, length, list,xy,links){
			depth = depth + 1;
		     root['y'] = depth;
			if(xy[1] < depth){
				xy[1] = depth;
			}
			root["name"] = root.subjectName;
	         if(root.leftChild != null){
	            length = traval(root.leftChild, depth, length, list,xy, links);
	            var link = {
	            		"source":root.subjectName,
	            		"target":root.leftChild.subjectName,
	            		"symbol":["circle","arrow"]
	            	}
	            if(root.leftChild.relPos == 1){
	            	link["target"] = root.subjectName;
	            	link["source"] = root.leftChild.subjectName;
	            }
	            links.push(link);
	         }
	         length = length + 1;
	         root['x'] = length;
			if(xy[0] < length){
				xy[0] = length;
			}
	        if(root.rightChild != null){
	            length = traval(root.rightChild, depth, length, list,xy, links);
	            var link = {
	            		"source":root.subjectName,
	            		"target":root.rightChild.subjectName,
	            		"symbol":["circle","arrow"]
	            	}
	            if(root.rightChild.relPos == 1){
	            	link["target"] = root.subjectName;
	            	link["source"] = root.rightChild.subjectName;
	            }
	            links.push(link);
	         }
	         root.left = null;
	         root.right = null;
	         list.push(root);
	         return length;
		}
		var list=[];
		var xy=[0,0];
		var links = [];
		traval(root, 0, 0, list,xy,links);

		var xLength = xy[0], yLength = xy[1];
		var xWidth = $("#binary-tree").width();
		var yHeight = $("#binary-tree").height();

		var xStep = xWidth / xLength;
		var yStep = yHeight / yLength;

		var TreeDdata = [];
		for(var i in list){
			var node = list[i];
			var showData = {
				"name":node.name,
				"x": (node.x - 1) * xStep,
				"y": (node.y - 1) * yStep
			}
			TreeDdata.push(showData)
		}

		// 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('binary-tree'));

        // 指定图表的配置项和数据
        var option = {
		    title: {
		        text: 'Graph 简单示例',
		        left:'center'
		    },
		    tooltip: {},
		    animationDurationUpdate: 1500,
		    animationEasingUpdate: 'quinticInOut',
		    series : [
		        {
		            type: 'graph',
		            layout: 'none',
		            symbolSize: 50,
		            roam: true,
		            label: {
		                normal: {
		                    show: true
		                }
		            },
		            edgeSymbol: ['circle'],
		            edgeSymbolSize: [4, 10],
		            edgeLabel: {
		                normal: {
		                    textStyle: {
		                        fontSize: 20
		                    }
		                }
		            },
		            data: TreeDdata,
		            // links: [],
		            links: links,
		            lineStyle: {
		                normal: {
		                    opacity: 0.9,
		                    width: 2,
		                    curveness: 0
		                }
		            }
		        }
		    ]
		};
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
	</script>
</body>
</html>